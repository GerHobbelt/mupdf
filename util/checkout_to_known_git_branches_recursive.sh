#! /bin/bash
#
# Generated by the utility: ../../../util/collect_git_checked_out_branch_recusively.sh 
#
# Checkout each git repository to the given branch/commit or list them
#

mode=h;
while getopts ":hlc" opt ; do
  #echo opt+arg = "$opt$OPTARG"
  case "$opt$OPTARG" in
  l )
    mode=h;
    ;;

  c )
    mode=c;
    ;;

  r )
    mode=r;
    ;;

  * )
    cat <<EOH
checkout_to_known_git_branches_recursive.sh options

Options:

-h      : print this help 
-l      : LIST the branch/commit for each git repository (directory) registered in this script.
-c      : CHECKOUT each git repository to the BRANCH registered in this script.
-r      : CHECKOUT/REVERT each git repository to the COMMIT registered in this script.

Note:

Use the '-r' option to set each repository to an exact commit position, which is useful if,
for instance, you wish to reproduce this registered previous software state (which may 
represent a software release) which you wish to analyze/debug.

EOH
    exit 1;
    ;;
  esac
done

if test "$mode" = "h" ; then
  cat <<EOH

Git repository directory                    :: commit hash                         / branch name
--------------------------------------------::--------------------------------------------------
EOH
fi



# args: DIR COMMIT [BRANCH]
git_repo_checkout_branch() {
  if test "$mode" = "c" || test "$mode" = "r" ; then
    if test -d "$1" ; then
      pushd "$1"                                                               2> /dev/null  > /dev/null
      if test "$mode" = "c" ; then
        if test -n "$3" ; then
          # make sure the branch is created locally and is a tracking branch:
          git branch --track "$3" "remotes/origin/$3"                            2> /dev/null  > /dev/null
          git checkout "$3"
        else
          git checkout master
        fi
      else
        git checkout "$2"
      fi
      popd                                                                     2> /dev/null  > /dev/null
    fi
  else
    if test -d "$1" ; then
      printf "%-43s :: %s / %s\n" "$1" "$2" "$3"
    else
      printf "%-43s :: %s / %s\n" "[DIRECTORY DOES NOT EXIST!] $1" "$2" "$3"
    fi
  fi
}


#
# Make sure we switch to the utility directory as all the relative paths for the repositories
# are based off that path!
#
pushd $(dirname $0)                                                            2> /dev/null  > /dev/null



#
# The registered repositories:
#

git_repo_checkout_branch "../../../CS/MuPDF/thirdparty/curl" f527d6002dad50c57e9944ed75a85b7e5788f7da mupdf
git_repo_checkout_branch "../../../CS/MuPDF/thirdparty/freeglut" 7a020dfcaec9c02df4b5c1b8c76ca2149601d709 heap-corruption-in-muraster
git_repo_checkout_branch "../../../CS/MuPDF/thirdparty/freetype" 24df965835afb009f5eb5dc238ed4205b8992de6 mupdf
git_repo_checkout_branch "../../../CS/MuPDF/thirdparty/gumbo-parser" 66653fcc8671fbf5a5062a69302d18f2554d6f8d heap-corruption-in-muraster
git_repo_checkout_branch "../../../CS/MuPDF/thirdparty/gumbo-parser/testdata" 6ddcf58bea5a01e616911050c173622f84297211 master
git_repo_checkout_branch "../../../CS/MuPDF/thirdparty/gumbo-parser/third_party/gtest" b13bdb93206ade272b4d7ed1c197c937d7d52796 master
git_repo_checkout_branch "../../../CS/MuPDF/thirdparty/harfbuzz" c4e3af320f11b86814d149126e7a3ebbfe5efe12 heap-corruption-in-muraster
git_repo_checkout_branch "../../../CS/MuPDF/thirdparty/jbig2dec" 1268112485771909fca028442bdc54b7424d1bad heap-corruption-in-muraster
git_repo_checkout_branch "../../../CS/MuPDF/thirdparty/lcms2" 9bdfd398d2031ebe50bd87db912a92c1136c5c88 heap-corruption-in-muraster
git_repo_checkout_branch "../../../CS/MuPDF/thirdparty/leptonica" 707e4d4c23654215f5f25f54d9c0a24f59e89873 heap-corruption-in-muraster
git_repo_checkout_branch "../../../CS/MuPDF/thirdparty/libjpeg" 2727a4365ae480ecda656e8372f4c782c8dcc2df heap-corruption-in-muraster
git_repo_checkout_branch "../../../CS/MuPDF/thirdparty/mujs" 2704d8835b65b354b2411f560f9c90aa3842492a mupdf
git_repo_checkout_branch "../../../CS/MuPDF/thirdparty/openjpeg" 8b8de53dc38642cc3f57596db2672e9f3a40f357 heap-corruption-in-muraster
git_repo_checkout_branch "../../../CS/MuPDF/thirdparty/tesseract" beaaa634e96618316c94b7a61cca127859f8dcc3 heap-corruption-in-muraster
git_repo_checkout_branch "../../../CS/MuPDF/thirdparty/tesseract/abseil" 4d2ff381a3709ef9dd4cbc0237bae847c0bb1ccd master
git_repo_checkout_branch "../../../CS/MuPDF/thirdparty/tesseract/googletest" df6b75949b1efab7606ba60c0f0a0125ac95c5af master
git_repo_checkout_branch "../../../CS/MuPDF/thirdparty/tesseract/test" e27d9566917d7d167636a7d0cd59bcfb2c61c7eb master
git_repo_checkout_branch "../../../CS/MuPDF/thirdparty/zlib" 41b5852eba5825bd41900df01ffc8431c56eae31 heap-corruption-in-muraster

# --- all done ---

popd                                                                           2> /dev/null  > /dev/null

